<div class="image-component image-hero-booking">
    <img src="./{{ component.content.slug }}.{{ component.content.format }}"
         alt="{{ component.content.alt_text | default(value='') }}"
         loading="eager"
         fetchpriority="high"
         decoding="async">

    <div class="hero-booking-overlay">
        <div class="hero-booking-content">
            {% if component.title %}
            <h1 class="hero-booking-title">{{ component.title }}</h1>
            {% endif %}

            <form class="booking-form" onsubmit="return submitBooking(this)">
                <div class="booking-fields">
                    <div class="booking-field">
                        <label for="checkin">Check-In</label>
                        <input type="text" id="checkin" placeholder="Select date" readonly>
                    </div>
                    <div class="booking-field">
                        <label for="checkout">Check-Out</label>
                        <input type="text" id="checkout" placeholder="Select date" readonly>
                    </div>
                    <div class="booking-field">
                        <label for="guests">Guests</label>
                        <select id="guests">
                            <option value="1">1 Guest</option>
                            <option value="2" selected>2 Guests</option>
                            <option value="3">3 Guests</option>
                            <option value="4">4 Guests</option>
                            <option value="5">5 Guests</option>
                            <option value="6">6+ Guests</option>
                        </select>
                    </div>
                    <button type="submit" class="booking-submit">Search</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Flatpickr CSS -->
<link rel="stylesheet" href="/.static/vendor/flatpickr/flatpickr.min.css">
<link rel="stylesheet" href="/.static/vendor/flatpickr/airbnb.css">

<!-- Flatpickr JS -->
<script defer src="/.static/vendor/flatpickr/flatpickr.min.js"></script>

<script>
function formatDateISO(d) {
    var y = d.getFullYear();
    var m = String(d.getMonth() + 1).padStart(2, '0');
    var day = String(d.getDate()).padStart(2, '0');
    return y + '-' + m + '-' + day;
}

function submitBooking(form) {
    var ci = document.getElementById('checkin')._flatpickr.selectedDates[0];
    var co = document.getElementById('checkout')._flatpickr.selectedDates[0];
    var guests = document.getElementById('guests').value;
    if (!ci || !co) return false;
    // Override this template per-site with the correct booking URL
    console.warn('hero_booking: no site-specific booking URL configured');
    alert('Booking not configured for this site.');
    return false;
}

document.addEventListener('DOMContentLoaded', function() {
    var today = new Date();
    var tomorrow = new Date(today);
    tomorrow.setDate(tomorrow.getDate() + 1);
    var dayAfter = new Date(today);
    dayAfter.setDate(dayAfter.getDate() + 2);

    var checkinPicker = flatpickr("#checkin", {
        disableMobile: true,
        dateFormat: "M d, Y",
        minDate: "today",
        defaultDate: tomorrow,
        onChange: function(selectedDates) {
            if (selectedDates[0]) {
                var nextDay = new Date(selectedDates[0]);
                nextDay.setDate(nextDay.getDate() + 1);
                checkoutPicker.set('minDate', nextDay);
                var currentCheckout = checkoutPicker.selectedDates[0];
                if (!currentCheckout || currentCheckout <= selectedDates[0]) {
                    var plusFive = new Date(selectedDates[0]);
                    plusFive.setDate(plusFive.getDate() + 5);
                    checkoutPicker.setDate(plusFive);
                }
            }
        }
    });

    var checkoutPicker = flatpickr("#checkout", {
        disableMobile: true,
        dateFormat: "M d, Y",
        minDate: dayAfter,
        defaultDate: dayAfter
    });
});
</script>
